Module spray_deposition_curve
   implicit none
    !spraycurve is in 2 meter increments; Columns: Medium, Course, Very Course
    real,dimension(398,3),parameter :: spraycurve = transpose(reshape((/&
    0.1772473,0.1251549,0.09527954,&
    0.1688408,0.1155953,0.08512489,&
    0.1614663,0.1104872,0.07583684,&
    0.1462082,0.09878722,0.06508424,&
    0.1317696,0.08647036,0.05518508,&
    0.1164526,0.07523555,0.04670228,&
    0.1054502,0.06672306,0.04325569,&
    0.09616384,0.05922497,0.04029952,&
    0.08759379,0.05221272,0.03610524,&
    0.08141632,0.04805676,0.03308862,&
    0.07501268,0.04530999,0.02923773,&
    0.06923079,0.04139921,0.02615554,&
    0.06532282,0.03855037,0.02445604,&
    0.06281212,0.03635633,0.02261726,&
    0.05991399,0.0345677,0.02087726,&
    0.05505019,0.03243622,0.01911343,&
    0.05091271,0.03025788,0.01770359,&
    0.04798148,0.02843215,0.01662719,&
    0.04620112,0.02707105,0.01567819,&
    0.04414034,0.02569139,0.01482213,&
    0.04192687,0.02433933,0.01403282,&
    0.04014468,0.02320946,0.01330321,&
    0.03877714,0.02226637,0.01251061,&
    0.03742525,0.02136378,0.01179297,&
    0.03619231,0.0204666,0.01113976,&
    0.03499434,0.01962688,0.0105573,&
    0.03374038,0.01875748,0.01002707,&
    0.03244286,0.01795755,0.009560417,&
    0.03128585,0.01723682,0.009146352,&
    0.03028598,0.01657861,0.008760021,&
    0.02938107,0.01597494,0.008407521,&
    0.02850821,0.01541552,0.008089088,&
    0.02766859,0.01489776,0.007806188,&
    0.02687368,0.01441664,0.007549527,&
    0.02606067,0.01396799,0.00731093,&
    0.02529103,0.01354466,0.007088533,&
    0.02457058,0.01315169,0.006880527,&
    0.02390063,0.01278997,0.006685631,&
    0.023272,0.0124503,0.006499367,&
    0.02267478,0.01212325,0.006318601,&
    0.02210679,0.01180726,0.006144061,&
    0.02156225,0.01150627,0.005979073,&
    0.02103997,0.01122751,0.005826935,&
    0.02054464,0.01097035,0.005687668,&
    0.02008267,0.01072816,0.005561918,&
    0.01965362,0.01049534,0.005447724,&
    0.01924971,0.01026885,0.005339943,&
    0.01886373,0.01004942,0.005236227,&
    0.01849185,0.009836666,0.005134625,&
    0.01813582,0.009632845,0.005035168,&
    0.01779545,0.00943787,0.004938284,&
    0.01747077,0.00924867,0.004844361,&
    0.01716172,0.009065134,0.004753896,&
    0.01686744,0.008891285,0.004668496,&
    0.01658793,0.008730899,0.004590211,&
    0.01632074,0.008582045,0.004517213,&
    0.01606536,0.008440816,0.004447856,&
    0.01582341,0.00830535,0.004381813,&
    0.01559476,0.008175896,0.004318757,&
    0.01537614,0.008051501,0.004258408,&
    0.01516328,0.007928761,0.004198514,&
    0.01495998,0.007808652,0.004139971,&
    0.01476623,0.00769109,0.004083681,&
    0.01457857,0.00757384,0.004028132,&
    0.01439688,0.007457623,0.003973053,&
    0.01422172,0.007346205,0.003919878,&
    0.01405489,0.007243353,0.003870459,&
    0.01389574,0.007148446,0.003824657,&
    0.01374263,0.007058512,0.003781502,&
    0.01359458,0.00697167,0.003740348,&
    0.01345273,0.006888276,0.00370098,&
    0.0133167,0.006808585,0.003662945,&
    0.0131861,0.006731782,0.003625681,&
    0.01306205,0.006657346,0.003589601,&
    0.01294496,0.006584963,0.003555209,&
    0.01283342,0.006513244,0.003522087,&
    0.01272602,0.006442214,0.003489988,&
    0.01262062,0.00637284,0.003458377,&
    0.01251525,0.006305736,0.003426568,&
    0.01241162,0.00624254,0.0033955,&
    0.01231003,0.006182852,0.003365598,&
    0.01221099,0.00612617,0.003336925,&
    0.01211487,0.00607209,0.003309387,&
    0.01202075,0.006019575,0.003282583,&
    0.01192963,0.005968451,0.003256452,&
    0.01184184,0.005918444,0.003230809,&
    0.01175751,0.005869505,0.003205784,&
    0.01167499,0.005820245,0.003180887,&
    0.01159455,0.005770567,0.003156371,&
    0.01151644,0.005721285,0.003132503,&
    0.0114387,0.005672621,0.00310871,&
    0.01136136,0.005625651,0.003085184,&
    0.01128462,0.005580905,0.00306235,&
    0.01120932,0.005538655,0.003040572,&
    0.01113483,0.005498171,0.003019536,&
    0.01106123,0.005458879,0.002999045,&
    0.01099007,0.005420866,0.002979234,&
    0.01092147,0.005383361,0.002959609,&
    0.01085543,0.005346543,0.002940303,&
    0.01079097,0.005310141,0.002921147,&
    0.01072833,0.005274283,0.002902257,&
    0.01066804,0.005239468,0.002883983,&
    0.01060876,0.005204998,0.002865948,&
    0.0105496,0.005170685,0.002848057,&
    0.01049081,0.005137319,0.002830737,&
    0.01043199,0.005105208,0.002814097,&
    0.0103729,0.005074254,0.002797996,&
    0.01031406,0.005044225,0.002782363,&
    0.01025711,0.005015411,0.002767416,&
    0.01020227,0.004987064,0.002752689,&
    0.01015055,0.004959398,0.002738283,&
    0.01010152,0.004932279,0.002724179,&
    0.01005392,0.004905086,0.002710057,&
    0.0100078,0.004878221,0.00269615,&
    0.00996289,0.004851785,0.002682584,&
    0.009917969,0.004825406,0.002669172,&
    0.009873446,0.004799831,0.002656298,&
    0.009828295,0.004775021,0.002643898,&
    0.00978219,0.004750943,0.002631868,&
    0.009735581,0.004727465,0.002620141,&
    0.00969065,0.004705207,0.002609124,&
    0.009647495,0.004683468,0.002598417,&
    0.009606354,0.004661972,0.00258782,&
    0.009567699,0.004640996,0.002577503,&
    0.009530447,0.004620096,0.002567237,&
    0.009494608,0.004599392,0.002557107,&
    0.009459954,0.004578942,0.002547191,&
    0.009425936,0.00455871,0.002537486,&
    0.009392462,0.004539054,0.002528175,&
    0.009358122,0.004519662,0.002519055,&
    0.009322618,0.004500663,0.002510139,&
    0.009286419,0.004482109,0.002501445,&
    0.009250932,0.004464478,0.002493273,&
    0.009216332,0.004447334,0.002485367,&
    0.009182374,0.00443013,0.00247739,&
    0.009149781,0.004413232,0.002469542,&
    0.0091185,0.004396563,0.002461802,&
    0.009088227,0.004379851,0.002454046,&
    0.009059187,0.004363244,0.0024464,&
    0.009031083,0.00434674,0.002438902,&
    0.009003925,0.004330684,0.002431728,&
    0.008976621,0.004314942,0.002424776,&
    0.008948141,0.004299338,0.002417878,&
    0.008918395,0.004283844,0.002410981,&
    0.00888826,0.004268801,0.002404295,&
    0.008858453,0.004254301,0.00239787,&
    0.008829115,0.004240024,0.002391515,&
    0.008800647,0.004226073,0.002385251,&
    0.008772902,0.004212245,0.002379003,&
    0.008745501,0.004198144,0.002372595,&
    0.008718889,0.004184015,0.0023662,&
    0.008693367,0.004170158,0.002360031,&
    0.008668804,0.004156701,0.002354164,&
    0.008644252,0.004143425,0.002348439,&
    0.008619072,0.004130275,0.002342733,&
    0.008593117,0.004117216,0.002336998,&
    0.008566589,0.004104339,0.002331311,&
    0.008540294,0.004091948,0.002325835,&
    0.008514178,0.00407974,0.002320377,&
    0.008488527,0.004067802,0.00231497,&
    0.008463198,0.004055921,0.002309534,&
    0.008437919,0.004043779,0.002303937,&
    0.008412949,0.004031464,0.002298268,&
    0.008388531,0.004019205,0.002292698,&
    0.008364735,0.004007227,0.002287342,&
    0.008341367,0.00399552,0.002282171,&
    0.008317763,0.003983869,0.002277018,&
    0.008294046,0.003972368,0.00227189,&
    0.008270143,0.003960916,0.002266742,&
    0.008246348,0.0039497,0.002261685,&
    0.008222568,0.003938525,0.002256595,&
    0.008198919,0.003927428,0.002251479,&
    0.00817515,0.003916247,0.002246242,&
    0.008150806,0.003904615,0.002240736,&
    0.008126144,0.003892594,0.002235033,&
    0.008101965,0.003880681,0.002229452,&
    0.008078387,0.003869007,0.002224067,&
    0.008055244,0.003857574,0.002218842,&
    0.008031906,0.003846123,0.002213592,&
    0.008008169,0.003834605,0.002208237,&
    0.007984017,0.003822976,0.002202767,&
    0.007959787,0.003811466,0.002197307,&
    0.007935455,0.00379999,0.002191799,&
    0.007911127,0.00378849,0.002186218,&
    0.007886784,0.003776922,0.002180524,&
    0.007861883,0.003764948,0.002174574,&
    0.007836249,0.003752385,0.002168297,&
    0.007810512,0.003739596,0.002161935,&
    0.007785052,0.003726873,0.002155663,&
    0.007759856,0.003714255,0.002149478,&
    0.007734608,0.003701664,0.002143306,&
    0.00770915,0.003689087,0.002137091,&
    0.007683399,0.003676422,0.00213079,&
    0.00765761,0.003663827,0.002124483,&
    0.007631806,0.003651253,0.002118131,&
    0.007606193,0.003638767,0.002111762,&
    0.00758073,0.003626353,0.002105356,&
    0.007554818,0.003613622,0.002098736,&
    0.007528113,0.00360035,0.002091801,&
    0.007500863,0.003586708,0.00208467,&
    0.007473232,0.003572848,0.002077442,&
    0.007445516,0.003559001,0.002070218,&
    0.007417701,0.003545185,0.002062988,&
    0.007389928,0.003531512,0.002055779,&
    0.007362127,0.003517856,0.002048539,&
    0.007334464,0.003504247,0.002041297,&
    0.007307165,0.003490766,0.002034072,&
    0.007280184,0.003477332,0.002026815,&
    0.007253451,0.00346391,0.002019495,&
    0.007226413,0.003450233,0.002011993,&
    0.007198801,0.003436131,0.002004247,&
    0.007170856,0.003421773,0.001996391,&
    0.00714276,0.003407293,0.001988523,&
    0.007114555,0.003392775,0.001980668,&
    0.007086426,0.003378333,0.001972857,&
    0.007058467,0.003364039,0.001965098,&
    0.00703062,0.003349903,0.001957368,&
    0.007002685,0.003335774,0.001949591,&
    0.006974928,0.003321758,0.001941798,&
    0.006947462,0.00330789,0.001934018,&
    0.006920168,0.003294083,0.001926204,&
    0.006892649,0.003280122,0.001918255,&
    0.006864694,0.003265856,0.00191013,&
    0.006836419,0.003251323,0.001901887,&
    0.006807996,0.003236632,0.00189362,&
    0.006779321,0.003221786,0.001885305,&
    0.006750608,0.003206981,0.001877016,&
    0.006721943,0.003192269,0.001868761,&
    0.006693252,0.00317759,0.001860495,&
    0.00666462,0.003162947,0.001852224,&
    0.00663635,0.003148479,0.001844001,&
    0.006608516,0.003134182,0.001835832,&
    0.006581125,0.003120005,0.001827702,&
    0.006553968,0.003105865,0.001819583,&
    0.006526575,0.003091519,0.001811375,&
    0.006498846,0.003076925,0.001803062,&
    0.006470822,0.003062169,0.001794701,&
    0.006442493,0.003047349,0.001786317,&
    0.006413878,0.003032563,0.001777937,&
    0.006385035,0.00301784,0.001769565,&
    0.006356056,0.003003191,0.001761197,&
    0.006326979,0.002988573,0.001752823,&
    0.006298197,0.002974119,0.001744512,&
    0.006269784,0.002959834,0.00173626,&
    0.006241693,0.002945655,0.001728028,&
    0.006213894,0.002931575,0.001719818,&
    0.006186046,0.002917393,0.001711557,&
    0.006157877,0.002902939,0.001703172,&
    0.00612943,0.00288827,0.001694704,&
    0.006100758,0.002873437,0.001686179,&
    0.006071941,0.002858561,0.001677643,&
    0.006043099,0.002843745,0.001669138,&
    0.006014256,0.002829005,0.001660661,&
    0.005985365,0.002814301,0.001652196,&
    0.005956776,0.002799785,0.001643827,&
    0.005928707,0.002785549,0.001635592,&
    0.005900966,0.002771439,0.001627399,&
    0.00587342,0.002757355,0.001619193,&
    0.005845957,0.002743256,0.001610978,&
    0.005818227,0.002728934,0.001602657,&
    0.005790273,0.002714451,0.001594271,&
    0.005762135,0.002699844,0.001585829,&
    0.00573368,0.002685085,0.001577303,&
    0.00570499,0.002670242,0.001568714,&
    0.005676277,0.002655442,0.00156012,&
    0.00564765,0.002640776,0.001551574,&
    0.005619344,0.002626364,0.001543144,&
    0.005591555,0.002612317,0.001534895,&
    0.005564207,0.002598565,0.001526796,&
    0.005537087,0.00258493,0.001518757,&
    0.005509999,0.002571288,0.001510732,&
    0.005482764,0.002557501,0.001502657,&
    0.005455305,0.002543547,0.001494519,&
    0.005427697,0.002529488,0.00148634,&
    0.00539984,0.002515292,0.001478081,&
    0.005371717,0.00250098,0.001469732,&
    0.00534349,0.002486628,0.001461338,&
    0.005315354,0.002472337,0.001452964,&
    0.005287485,0.002458189,0.001444664,&
    0.005260179,0.002444375,0.001436536,&
    0.005233452,0.002430918,0.001428591,&
    0.005206998,0.002417629,0.001420733,&
    0.005180601,0.002404405,0.001412916,&
    0.005154072,0.002391102,0.001405076,&
    0.005127244,0.002377609,0.001397156,&
    0.005100202,0.002363968,0.001389164,&
    0.005072996,0.002350207,0.001381097,&
    0.00504556,0.002336308,0.001372931,&
    0.005018068,0.00232237,0.001364717,&
    0.004990722,0.002308523,0.001356533,&
    0.00496366,0.002294878,0.001348451,&
    0.004937075,0.002281552,0.001340538,&
    0.004910972,0.002268563,0.001332807,&
    0.004885122,0.00225578,0.001325191,&
    0.004859328,0.002243124,0.001317656,&
    0.004833458,0.002230505,0.001310162,&
    0.004807371,0.002217839,0.001302668,&
    0.004781075,0.002205127,0.001295165,&
    0.00475462,0.002192341,0.001287622,&
    0.004727894,0.00217939,0.00127998,&
    0.004701032,0.002166287,0.001272236,&
    0.004674275,0.002153132,0.001264448,&
    0.004647771,0.002140029,0.001256681,&
    0.004621661,0.002127079,0.001248986,&
    0.004595976,0.002114335,0.001241385,&
    0.004570574,0.00210173,0.001233842,&
    0.004545237,0.002089174,0.00122632,&
    0.0045199,0.002076674,0.001218834,&
    0.004494491,0.002064213,0.001211388,&
    0.004468974,0.002051776,0.001203976,&
    0.004443355,0.002039328,0.001196569,&
    0.004417572,0.00202682,0.001189135,&
    0.00439168,0.002014227,0.001181657,&
    0.00436586,0.00200161,0.00117417,&
    0.004340376,0.001989118,0.001166757,&
    0.004315459,0.001976872,0.001159477,&
    0.004291123,0.001964908,0.00115234,&
    0.004267233,0.001953191,0.001145327,&
    0.004243496,0.001941612,0.001138384,&
    0.00421969,0.001930108,0.001131484,&
    0.004195717,0.001918633,0.001124612,&
    0.00417148,0.001907141,0.001117742,&
    0.004146912,0.001895559,0.001110824,&
    0.00412208,0.001883882,0.001103852,&
    0.004097058,0.00187207,0.001096799,&
    0.004072051,0.001860161,0.001089694,&
    0.004047362,0.001848292,0.001082616,&
    0.004023247,0.001836598,0.001075643,&
    0.003999781,0.001825123,0.001068794,&
    0.003976882,0.00181385,0.001062065,&
    0.003954274,0.00180268,0.001055404,&
    0.003931701,0.001791563,0.001048784,&
    0.00390905,0.001780485,0.001042187,&
    0.003886205,0.001769434,0.001035607,&
    0.003863054,0.001758355,0.001028997,&
    0.00383963,0.001747245,0.001022347,&
    0.003816017,0.001736088,0.00101565,&
    0.003792378,0.0017249,0.001008928,&
    0.003768981,0.001713793,0.001002259,&
    0.003746074,0.00170288,0.000995717,&
    0.003723745,0.001692174,0.000989313,&
    0.003701916,0.001681621,0.000983019,&
    0.003680419,0.001671151,0.000976795,&
    0.003659051,0.001660725,0.000970611,&
    0.003637656,0.001650293,0.00096443,&
    0.003616121,0.001639842,0.000958241,&
    0.003594378,0.001629362,0.000952026,&
    0.003572432,0.001618851,0.000945773,&
    0.003550224,0.001608261,0.000939457,&
    0.003527885,0.001597619,0.000933099,&
    0.00350566,0.001587038,0.000926771,&
    0.003483837,0.001576651,0.000920555,&
    0.003462596,0.001566504,0.000914482,&
    0.003441855,0.001556531,0.000908516,&
    0.00342149,0.001546665,0.000902624,&
    0.003401364,0.001536865,0.000896788,&
    0.003381251,0.00152706,0.000890963,&
    0.003361038,0.00151724,0.000885138,&
    0.003340638,0.001507392,0.000879297,&
    0.003320043,0.001497526,0.000873438,&
    0.003299198,0.001487603,0.000867539,&
    0.003278151,0.001477615,0.000861596,&
    0.003257033,0.001467628,0.00085565,&
    0.003236102,0.001457762,0.000849768,&
    0.003215603,0.001448097,0.000844004,&
    0.00319553,0.001438593,0.000838339,&
    0.003175838,0.001429202,0.000832751,&
    0.003156466,0.001419897,0.000827223,&
    0.003137286,0.001410636,0.000821735,&
    0.003118224,0.00140142,0.000816285,&
    0.003099249,0.001392259,0.000810871,&
    0.003080346,0.001383148,0.000805479,&
    0.003061469,0.001374067,0.000800089,&
    0.003042564,0.001364983,0.000794673,&
    0.003023679,0.001355939,0.000789261,&
    0.003004947,0.001347015,0.000783901,&
    0.002986505,0.001338255,0.000778628,&
    0.002968392,0.001329642,0.000773444,&
    0.002950563,0.001321129,0.000768328,&
    0.002932939,0.001312668,0.000763255,&
    0.002915369,0.001304199,0.000758197,&
    0.002897802,0.001295725,0.000753156,&
    0.002880177,0.001287233,0.000748126,&
    0.002862491,0.001278723,0.000743099,&
    0.002844743,0.001270195,0.000738076,&
    0.002826878,0.00126164,0.000733035,&
    0.002808979,0.00125313,0.000728011,&
    0.002791189,0.001244762,0.000723051,&
    0.002773653,0.001236591,0.000718189,&
    0.002756446,0.001228602,0.000713421,&
    0.002739545,0.001220749,0.00070873,&
    0.002722912,0.001213002,0.000704096,&
    0.002706395,0.001205276,0.000699475,&
    0.00268995,0.00119755,0.000694853,&
    0.002673563,0.00118983,0.00069023,&
    0.002657233,0.0011821,0.000685597,&
    0.002640968,0.001174359,0.000680958,&
    0.002624673,0.001166576,0.000676295 &
    /),(/3,398/)))      
    
    contains
    subroutine trapezoid_rule(first,last, column)
    real, intent(in) :: first, last ! end point of distance to be integrated meters
    integer, intent(in) :: column
    real, parameter :: incr = 2.0 !table is in 2 meter increments
    integer :: index_one, index_two, i
    real :: actual_one, actual_two, area, X, Y, actual_Y1,actual_Y2, front_area, rear_area
    
        area= 0.0
        !check where "first" is, table is in 2's 
    
        if (first == 0.0) then 
            index_one  = 1
            actual_one = 1
        else
            actual_one = first/incr +1           !real number: convert inputs to index equivalents
            index_one = ceiling(actual_one)      !integer, index of nearest
        end if
        
        actual_two = last/incr +1         !real
        index_two = floor(actual_two)     !integer
        

        area = spraycurve(index_one,column) + spraycurve(index_two,column)
        do i = index_one+1, index_two-1
            area = area + 2.0*spraycurve(i,column)  !trapezoid rule 
        end do 
        
        area = area*incr/2.0  !Trapezoid rule finish
        
 write(96,*) "internal area", area       
        
        !add in the front partial increment
        if (first /= 0.0) then
            X =    index_one- actual_one  ! *incr/incr with following equation cancels out
            Y =  X * (spraycurve(index_one-1, column) - spraycurve(index_one, column)) 
            actual_Y1 = spraycurve(index_one, 1) + Y 
            front_area =   (index_one - actual_one)*incr * (spraycurve(index_one,column) + actual_Y1)/2.0
        end if
write(96,*) "front ",  front_area
        !add in the rear partial increment
            X =    actual_two - index_two
            
            Y =  X * (spraycurve(index_two, column) - spraycurve(index_two+1, column)) 
            actual_Y2 = spraycurve(index_two, 1) -Y
            
write(96,*) "y2 " , actual_Y2
            rear_area =   (actual_two - index_two)*incr * (spraycurve(index_two,column) + actual_Y2)/2.0
 write(96,*) "rear ", rear_area
        
        
        
        
        area = area + front_area + rear_area
        
        write(96,*), "area = ", area
        
        !now add in the last partial increment
    
    
    end subroutine trapezoid_rule


end module spray_deposition_curve